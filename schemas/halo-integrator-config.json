{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Halo Integrator Configuration",
  "description": "Configuration for HaloPSA's native Halo Integrator polling service",
  "type": "object",
  "properties": {
    "integrator_config": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string",
          "maxLength": 100,
          "description": "Display name for the integration"
        },
        "description": {
          "type": "string",
          "maxLength": 500,
          "description": "Description of what this integration does"
        },
        "endpoint_url": {
          "type": "string",
          "format": "uri",
          "description": "URL of your custom API endpoint that Halo Integrator will poll"
        },
        "method": {
          "type": "string",
          "enum": ["GET", "POST"],
          "default": "GET",
          "description": "HTTP method for the request"
        },
        "poll_interval_minutes": {
          "type": "integer",
          "minimum": 5,
          "maximum": 1440,
          "default": 15,
          "description": "How often to poll the endpoint (5-1440 minutes)"
        },
        "timeout_seconds": {
          "type": "integer",
          "minimum": 10,
          "maximum": 300,
          "default": 30,
          "description": "Request timeout in seconds"
        },
        "retry_attempts": {
          "type": "integer",
          "minimum": 0,
          "maximum": 5,
          "default": 3,
          "description": "Number of retry attempts on failure"
        },
        "retry_delay_seconds": {
          "type": "integer",
          "minimum": 30,
          "maximum": 3600,
          "default": 60,
          "description": "Delay between retry attempts"
        },
        "active": {
          "type": "boolean",
          "default": true,
          "description": "Whether the integration is enabled"
        },
        "headers": {
          "type": "object",
          "patternProperties": {
            "^[A-Za-z-]+$": {
              "type": "string"
            }
          },
          "properties": {
            "Authorization": {
              "type": "string",
              "description": "API authentication header"
            },
            "Content-Type": {
              "type": "string",
              "default": "application/json"
            },
            "User-Agent": {
              "type": "string",
              "default": "HaloIntegrator/1.0"
            }
          }
        },
        "query_parameters": {
          "type": "object",
          "patternProperties": {
            "^[a-zA-Z_][a-zA-Z0-9_]*$": {
              "type": "string"
            }
          },
          "description": "Static query parameters to include with requests"
        }
      },
      "required": ["name", "endpoint_url", "method", "poll_interval_minutes"]
    },
    "endpoint_response_schema": {
      "type": "object",
      "description": "Expected response format from your custom endpoint",
      "properties": {
        "status": {
          "type": "string",
          "enum": ["success", "error"],
          "description": "Status of the response"
        },
        "records": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "action": {
                "type": "string",
                "enum": ["create", "update", "upsert", "delete"],
                "description": "Action to perform on the record"
              },
              "entity_type": {
                "type": "string",
                "enum": ["organization", "contact", "prospect", "ticket"],
                "description": "Type of HaloPSA entity"
              },
              "external_id": {
                "type": "string",
                "description": "Unique identifier from the source system"
              },
              "data": {
                "type": "object",
                "description": "Entity data in HaloPSA format"
              },
              "metadata": {
                "type": "object",
                "description": "Additional metadata about the record"
              }
            },
            "required": ["action", "entity_type", "data"]
          }
        },
        "total_count": {
          "type": "integer",
          "minimum": 0,
          "description": "Total number of records in this response"
        },
        "last_sync_timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp for tracking incremental sync"
        },
        "metadata": {
          "type": "object",
          "properties": {
            "source": {
              "type": "string",
              "description": "Source system name"
            },
            "sync_type": {
              "type": "string",
              "enum": ["full", "incremental"],
              "description": "Type of sync performed"
            },
            "api_version": {
              "type": "string"
            }
          }
        }
      },
      "required": ["status", "records"],
      "if": {
        "properties": {
          "status": { "const": "error" }
        }
      },
      "then": {
        "properties": {
          "error_code": {
            "type": "string",
            "description": "Error code for debugging"
          },
          "message": {
            "type": "string",
            "description": "Human-readable error message"
          },
          "retry_after_seconds": {
            "type": "integer",
            "minimum": 60,
            "description": "Seconds to wait before retrying"
          }
        },
        "required": ["error_code", "message"]
      }
    },
    "example_configurations": {
      "type": "object",
      "properties": {
        "apollo_contact_sync": {
          "type": "object",
          "example": {
            "name": "Apollo.io Contact Sync",
            "description": "Sync contacts from Apollo.io lead database",
            "endpoint_url": "https://your-integration-api.com/halo-integrator/apollo/contacts",
            "method": "GET",
            "poll_interval_minutes": 15,
            "timeout_seconds": 30,
            "retry_attempts": 3,
            "retry_delay_seconds": 60,
            "active": true,
            "headers": {
              "Authorization": "Bearer {your_api_token}",
              "Content-Type": "application/json"
            },
            "query_parameters": {
              "source": "apollo",
              "format": "halopsa"
            }
          }
        },
        "zoominfo_enrichment": {
          "type": "object",
          "example": {
            "name": "ZoomInfo Data Enrichment",
            "description": "Enrich existing contacts with ZoomInfo data",
            "endpoint_url": "https://your-api.com/halo-integrator/zoominfo/enrich",
            "method": "POST",
            "poll_interval_minutes": 60,
            "timeout_seconds": 45,
            "headers": {
              "Authorization": "Bearer {token}",
              "X-Integration-Key": "{integration_key}"
            }
          }
        },
        "multi_source_leads": {
          "type": "object",
          "example": {
            "name": "Multi-Source Lead Aggregation",
            "description": "Aggregate leads from multiple B2B sources",
            "endpoint_url": "https://your-middleware.com/api/leads/aggregate",
            "method": "GET",
            "poll_interval_minutes": 30,
            "query_parameters": {
              "sources": "apollo,uplead,hunter",
              "quality_threshold": "80"
            }
          }
        }
      }
    },
    "error_handling": {
      "type": "object",
      "properties": {
        "retry_conditions": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "http_status": {
                "type": "array",
                "items": {
                  "type": "integer"
                },
                "description": "HTTP status codes that should trigger a retry"
              },
              "error_codes": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Application error codes that should trigger a retry"
              }
            }
          },
          "default": [
            {
              "http_status": [429, 500, 502, 503, 504],
              "error_codes": ["RATE_LIMIT", "TEMPORARY_ERROR", "TIMEOUT"]
            }
          ]
        },
        "failure_notifications": {
          "type": "object",
          "properties": {
            "email_alerts": {
              "type": "array",
              "items": {
                "type": "string",
                "format": "email"
              },
              "description": "Email addresses to notify on integration failures"
            },
            "webhook_url": {
              "type": "string",
              "format": "uri",
              "description": "Webhook URL to call on failures"
            },
            "max_consecutive_failures": {
              "type": "integer",
              "minimum": 1,
              "default": 5,
              "description": "Disable integration after this many consecutive failures"
            }
          }
        }
      }
    }
  },
  "required": ["integrator_config", "endpoint_response_schema"]
}