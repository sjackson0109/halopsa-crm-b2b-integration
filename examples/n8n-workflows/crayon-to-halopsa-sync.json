{
  "name": "Crayon to HaloPSA Sync",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "cronExpression",
              "expression": "0 */15 * * * *"
            }
          ]
        }
      },
      "name": "Schedule Trigger",
      "type": "n8n-nodes-base.cron",
      "typeVersion": 1,
      "position": [
        240,
        300
      ]
    },
    {
      "parameters": {
        "method": "GET",
        "url": "https://api.crayon.com/v1/contacts",
        "headers": {
          "Authorization": "Bearer {{$env.CRAYON_API_KEY}}",
          "Content-Type": "application/json"
        },
        "queryParameters": {
          "limit": 25,
          "offset": 0
        }
      },
      "name": "Crayon",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 1,
      "position": [
        460,
        300
      ]
    },
    {
      "parameters": {
        "functionCode": "const transformedContacts = items.map(item => {\n  const contact = item.json;\n  return {\n    firstname: contact.firstName,\n    surname: contact.lastName,\n    emailaddress: contact.email,\n    jobtitle: contact.jobTitle,\n    phonenumber: contact.phoneNumber,\n    organisation_name: contact.companyName\n  };\n});\n\nreturn transformedContacts;"
      },
      "name": "Transform Data",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        680,
        300
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://{{$env.HALOPSA_TENANT}}.halopsa.com/api/Contact",
        "headers": {
          "Authorization": "Bearer {{$env.HALOPSA_ACCESS_TOKEN}}",
          "Content-Type": "application/json"
        }
      },
      "name": "HaloPSA",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 1,
      "position": [
        900,
        300
      ]
    }
  ],
  "connections": {
    "Schedule Trigger": {
      "main": [
        [
          {
            "node": "Crayon",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Crayon": {
      "main": [
        [
          {
            "node": "Transform Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Transform Data": {
      "main": [
        [
          {
            "node": "HaloPSA",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  }
}