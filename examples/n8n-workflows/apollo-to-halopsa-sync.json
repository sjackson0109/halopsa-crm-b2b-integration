{
  "name": "Apollo.io to HaloPSA Sync",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "cronExpression",
              "expression": "0 */15 * * * *"
            }
          ]
        }
      },
      "name": "Schedule Trigger",
      "type": "n8n-nodes-base.cron",
      "typeVersion": 1,
      "position": [
        240,
        300
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.apollo.io/v1/mixed_people/search",
        "headers": {
          "Cache-Control": "no-cache",
          "Content-Type": "application/json",
          "X-Api-Key": "={{$env.APOLLO_API_KEY}}"
        },
        "body": {
          "q_organization_domains": "target-domain.com",
          "page": 1,
          "per_page": 25
        }
      },
      "name": "Apollo.io",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 1,
      "position": [
        460,
        300
      ]
    },
    {
      "parameters": {
        "functionCode": "const transformedContacts = items.map(item => {\n  const person = item.json.person;\n  return {\n    firstname: person.first_name,\n    surname: person.last_name,\n    emailaddress: person.email,\n    jobtitle: person.title,\n    phonenumber: person.phone_numbers?.[0]?.sanitized_number,\n    organisation_name: person.organization?.name\n  };\n});\n\nreturn transformedContacts;"
      },
      "name": "Transform Data",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        680,
        300
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://{{$env.HALOPSA_TENANT}}.halopsa.com/api/Contact",
        "headers": {
          "Authorization": "Bearer {{$env.HALOPSA_ACCESS_TOKEN}}",
          "Content-Type": "application/json"
        }
      },
      "name": "HaloPSA",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 1,
      "position": [
        900,
        300
      ]
    }
  ],
  "connections": {
    "Schedule Trigger": {
      "main": [
        [
          {
            "node": "Apollo.io",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Apollo.io": {
      "main": [
        [
          {
            "node": "Transform Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Transform Data": {
      "main": [
        [
          {
            "node": "HaloPSA",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  }
}